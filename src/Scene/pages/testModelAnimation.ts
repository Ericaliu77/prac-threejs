import { useEffect } from "react";
import * as THREE from "three";
import { DRACOLoader } from "three/examples/jsm/loaders/DRACOLoader";
import { GLTFLoader } from "three/examples/jsm/loaders/GLTFLoader";
const clock = new THREE.Clock();

export default function testModelAnimation({renderer, camera, controls}:any) {
    let scene = new THREE.Scene();
    scene.background = new THREE.Color(0x272727);
    const mixers: THREE.AnimationMixer[] = []
    const jointStates = {
        "elfin_joint1": -3.24,
        "elfin_joint2": -0.18,
        "elfin_joint3": 1.21,
        "elfin_joint4": 3.16,
        "elfin_joint5": 0.79,
        "elfin_joint6": 0.39,
        "wheel_left_joint": -0.8,
        "wheel_right_joint": -0.01
    };
    const lidarData = [
        {
            "lidarType": "MAIN",
            "value": {
                "angleIncrement": 0.005799999926239252,
                "angleMax": 3.1414999961853027,
                "angleMin": -3.1414999961853027,
                "data": [
                    -1,
                    -1,
                    -1,
                    -1,
                    -1,
                    -1,
                    -1,
                    -1,
                    -1,
                    -1,
                    -1,
                    -1,
                    -1,
                    -1,
                    -1,
                    -1,
                    -1,
                    -1,
                    2.2329556941986084,
                    2.2504734992980957,
                    2.259345769882202,
                    2.2789535522460938,
                    2.285856246948242,
                    2.317812442779541,
                    2.3217854499816895,
                    2.3420300483703613,
                    2.363300085067749,
                    2.3652853965759277,
                    2.3902478218078613,
                    2.419041156768799,
                    2.4314937591552734,
                    2.4525575637817383,
                    2.4620983600616455,
                    2.4725799560546875,
                    2.5078747272491455,
                    2.5240583419799805,
                    2.535428047180176,
                    2.571732759475708,
                    1.323940396308899,
                    1.3201271295547485,
                    1.3072136640548706,
                    1.3000706434249878,
                    1.3679254055023193,
                    1.3077492713928223,
                    2.5005433559417725,
                    1.316092848777771,
                    2.485316514968872,
                    2.4763622283935547,
                    2.458487033843994,
                    2.46368670463562,
                    2.4451963901519775,
                    2.4318978786468506,
                    2.4227232933044434,
                    2.4306118488311768,
                    2.4172146320343018,
                    2.40848445892334,
                    2.4056224822998047,
                    2.3858344554901123,
                    2.3842055797576904,
                    2.372729539871216,
                    2.362865447998047,
                    2.375121593475342,
                    2.355902910232544,
                    2.3544046878814697,
                    2.3369929790496826,
                    2.3416903018951416,
                    2.3372104167938232,
                    2.322488307952881,
                    2.3141744136810303,
                    2.3012359142303467,
                    2.300196647644043,
                    2.3019497394561768,
                    2.2962539196014404,
                    2.2839815616607666,
                    2.288395643234253,
                    2.2778284549713135,
                    2.272862195968628,
                    2.27239990234375,
                    2.2612481117248535,
                    2.2595274448394775,
                    2.2417232990264893,
                    2.245025157928467,
                    2.235323667526245,
                    2.2360377311706543,
                    2.2316439151763916,
                    2.2258312702178955,
                    2.034339666366577,
                    2.031529426574707,
                    2.0191049575805664,
                    2.0205554962158203,
                    2.014143705368042,
                    2.0256688594818115,
                    -1,
                    -1,
                    -1,
                    -1,
                    -1,
                    -1,
                    -1,
                    -1,
                    -1,
                    -1,
                    -1,
                    -1,
                    -1,
                    -1,
                    -1,
                    -1,
                    -1,
                    -1,
                    -1,
                    2.011406421661377,
                    2.0069618225097656,
                    2.017958164215088,
                    1.9968129396438599,
                    2.020167112350464,
                    2.0075135231018066,
                    2.0149967670440674,
                    2.009603977203369,
                    2.0039379596710205,
                    1.9868322610855103,
                    2.0371406078338623,
                    2.000718355178833,
                    2.0241832733154297,
                    1.9873613119125366,
                    1.9929568767547607,
                    1.9976927042007446,
                    1.9896103143692017,
                    -1,
                    1.9977407455444336,
                    -1,
                    2.016124725341797,
                    -1,
                    2.0018956661224365,
                    -1,
                    2.002983331680298,
                    2.0024709701538086,
                    -1,
                    -1,
                    -1,
                    -1,
                    -1,
                    -1,
                    -1,
                    -1,
                    -1,
                    -1,
                    -1,
                    -1,
                    -1,
                    -1,
                    -1,
                    -1,
                    -1,
                    -1,
                    -1,
                    -1,
                    -1,
                    -1,
                    -1,
                    -1,
                    -1,
                    -1,
                    -1,
                    -1,
                    2.038271188735962,
                    2.0478625297546387,
                    2.043591260910034,
                    -1,
                    2.0480000972747803,
                    2.0460000038146973,
                    2.0460000038146973,
                    2.066999912261963,
                    2.053999900817871,
                    2.059000015258789,
                    2.065000057220459,
                    2.061000108718872,
                    2.072999954223633,
                    2.069999933242798,
                    2.063999891281128,
                    2.066999912261963,
                    2.065999984741211,
                    2.075000047683716,
                    2.0739998817443848,
                    2.0739998817443848,
                    2.0829999446868896,
                    2.0889999866485596,
                    2.075000047683716,
                    2.0829999446868896,
                    2.0880000591278076,
                    2.0789999961853027,
                    2.0889999866485596,
                    2.0989999771118164,
                    2.109999895095825,
                    2.0989999771118164,
                    2.1040000915527344,
                    2.11299991607666,
                    2.119999885559082,
                    2.0969998836517334,
                    2.117000102996826,
                    2.125999927520752,
                    2.1419999599456787,
                    2.13700008392334,
                    2.1389999389648438,
                    2.1419999599456787,
                    2.1449999809265137,
                    2.138000011444092,
                    2.1570000648498535,
                    2.1619999408721924,
                    2.174999952316284,
                    2.1589999198913574,
                    2.183000087738037,
                    2.1710000038146973,
                    2.174999952316284,
                    2.184000015258789,
                    2.180999994277954,
                    2.197000026702881,
                    2.2209999561309814,
                    2.2130002975463867,
                    2.2249999046325684,
                    2.2319998741149902,
                    2.2179999351501465,
                    2.2309999465942383,
                    2.236999988555908,
                    2.2259998321533203,
                    2.25,
                    2.246999740600586,
                    2.2769999504089355,
                    2.2799999713897705,
                    2.2889997959136963,
                    2.3050003051757812,
                    2.315000057220459,
                    2.3400001525878906,
                    2.3429996967315674,
                    2.3295304775238037,
                    2.3222556114196777,
                    2.2839550971984863,
                    2.2620577812194824,
                    2.2776620388031006,
                    2.2494165897369385,
                    2.228508949279785,
                    2.200319290161133,
                    2.186741590499878,
                    2.1585991382598877,
                    2.1377644538879395,
                    2.1114988327026367,
                    2.183000087738037,
                    2.115177631378174,
                    2.1279685497283936,
                    2.1110000610351562,
                    2.1130001544952393,
                    2.122999906539917,
                    2.125,
                    2.1419999599456787,
                    2.1440000534057617,
                    2.1490001678466797,
                    2.1649999618530273,
                    2.1670000553131104,
                    2.1710000038146973,
                    2.2039999961853027,
                    2.193000078201294,
                    2.2070000171661377,
                    2.2230000495910645,
                    2.2279999256134033,
                    2.240999937057495,
                    2.2420003414154053,
                    2.25,
                    2.259000062942505,
                    2.2769999504089355,
                    2.2780001163482666,
                    2.2950000762939453,
                    -1,
                    -1,
                    -1,
                    -1,
                    -1,
                    -1,
                    -1,
                    -1,
                    -1,
                    -1,
                    -1,
                    -1,
                    -1,
                    -1,
                    2.941999912261963,
                    -1,
                    1.8960000276565552,
                    1.8530000448226929,
                    1.869999885559082,
                    1.8669999837875366,
                    1.843999981880188,
                    1.8650000095367432,
                    1.8685283660888672,
                    1.8505374193191528,
                    1.8422030210494995,
                    1.838050127029419,
                    1.830220103263855,
                    1.8320001363754272,
                    1.8247281312942505,
                    1.809999942779541,
                    1.8070000410079956,
                    1.8000224828720093,
                    1.7929999828338623,
                    1.790000081062317,
                    1.7979999780654907,
                    1.781000018119812,
                    1.779000163078308,
                    1.7730000019073486,
                    1.7640000581741333,
                    1.7619999647140503,
                    1.746999979019165,
                    1.746999979019165,
                    1.7330000400543213,
                    1.7239999771118164,
                    1.7269999980926514,
                    1.725000023841858,
                    1.725000023841858,
                    1.7159998416900635,
                    1.7070000171661377,
                    1.7139999866485596,
                    1.6990000009536743,
                    1.7009998559951782,
                    1.7000000476837158,
                    1.690000057220459,
                    1.687999963760376,
                    1.684999942779541,
                    1.6759998798370361,
                    1.6759999990463257,
                    1.6699999570846558,
                    1.6660000085830688,
                    1.656999945640564,
                    1.6540000438690186,
                    1.649999976158142,
                    1.6440001726150513,
                    1.6469999551773071,
                    1.6419999599456787,
                    1.6330000162124634,
                    1.6330000162124634,
                    1.6280001401901245,
                    1.623000144958496,
                    1.6250001192092896,
                    1.621000051498413,
                    1.6180000305175781,
                    1.6139999628067017,
                    1.6130000352859497,
                    1.6080000400543213,
                    1.6100000143051147,
                    1.5950000286102295,
                    1.6050000190734863,
                    1.6019999980926514,
                    1.597000002861023,
                    1.590000033378601,
                    1.5820000171661377,
                    1.5779999494552612,
                    1.5809999704360962,
                    1.5789999961853027,
                    1.5740000009536743,
                    1.5789999961853027,
                    1.5750000476837158,
                    1.5770000219345093,
                    1.5679999589920044,
                    1.5720000267028809,
                    1.5630000829696655,
                    1.565000057220459,
                    1.559999942779541,
                    1.5640000104904175,
                    1.569000005722046,
                    1.5739998817443848,
                    1.5759999752044678,
                    1.5809998512268066,
                    1.5839999914169312,
                    1.5980000495910645,
                    1.5839999914169312,
                    1.5450000762939453,
                    1.5329999923706055,
                    1.5670000314712524,
                    -1,
                    -1,
                    -1,
                    -1,
                    -1,
                    -1,
                    -1,
                    -1,
                    2.489000082015991,
                    2.4809999465942383,
                    2.490999937057495,
                    2.4519999027252197,
                    2.4539999961853027,
                    2.4790000915527344,
                    2.48799991607666,
                    2.5380001068115234,
                    2.5510001182556152,
                    2.5759999752044678,
                    2.615999937057495,
                    2.6459999084472656,
                    2.6570000648498535,
                    2.7049999237060547,
                    2.73799991607666,
                    2.76200008392334,
                    2.819999933242798,
                    2.8459999561309814,
                    2.859999895095825,
                    2.9230000972747803,
                    2.9690003395080566,
                    2.993999719619751,
                    3.07200026512146,
                    3.0840001106262207,
                    3.128000020980835,
                    -1,
                    -1,
                    -1,
                    2.6019999980926514,
                    2.446000099182129,
                    2.427000045776367,
                    2.436000108718872,
                    2.4839999675750732,
                    2.505000114440918,
                    2.496999979019165,
                    2.500999927520752,
                    2.5139999389648438,
                    2.453000068664551,
                    2.3399999141693115,
                    2.2720000743865967,
                    2.260999917984009,
                    2.260999917984009,
                    2.25600004196167,
                    2.243000030517578,
                    2.247999906539917,
                    2.257999897003174,
                    2.2269999980926514,
                    2.2330000400543213,
                    2.256999969482422,
                    2.315999984741211,
                    -1,
                    -1,
                    -1,
                    2.825000047683716,
                    2.9119999408721924,
                    3.0299999713897705,
                    3.119999885559082,
                    3.1710000038146973,
                    3.187000036239624,
                    3.194999933242798,
                    3.2100000381469727,
                    3.2149999141693115,
                    3.1440000534057617,
                    3.0250000953674316,
                    2.8919999599456787,
                    2.808000087738037,
                    2.752000093460083,
                    2.6089999675750732,
                    2.549999952316284,
                    2.5159997940063477,
                    2.503999948501587,
                    2.509000062942505,
                    2.5169999599456787,
                    2.5129997730255127,
                    2.5179998874664307,
                    2.5260000228881836,
                    2.5290000438690186,
                    2.5260000228881836,
                    2.5369999408721924,
                    2.5390000343322754,
                    2.5429999828338623,
                    2.5490000247955322,
                    2.552999973297119,
                    2.562000036239624,
                    2.566999912261963,
                    2.565999984741211,
                    2.5729997158050537,
                    2.572999954223633,
                    2.5840001106262207,
                    2.5940001010894775,
                    2.5910000801086426,
                    2.5929999351501465,
                    2.6019999980926514,
                    2.611999750137329,
                    2.615999937057495,
                    2.640000104904175,
                    2.634000062942505,
                    2.640000104904175,
                    2.6489999294281006,
                    2.6559998989105225,
                    2.6559998989105225,
                    2.6630001068115234,
                    2.6720001697540283,
                    2.680000066757202,
                    2.684999942779541,
                    2.696000099182129,
                    2.696000099182129,
                    2.7130000591278076,
                    2.7200000286102295,
                    2.7249999046325684,
                    2.7330000400543213,
                    2.740000009536743,
                    2.749999761581421,
                    2.759999990463257,
                    2.7760000228881836,
                    2.7769999504089355,
                    2.7829999923706055,
                    2.7939999103546143,
                    2.7939999103546143,
                    2.799999952316284,
                    2.812000036239624,
                    2.830000162124634,
                    2.8320000171661377,
                    2.8540000915527344,
                    2.8610000610351562,
                    2.872999906539917,
                    2.880000114440918,
                    2.8910000324249268,
                    2.8949999809265137,
                    2.9169998168945312,
                    2.9170000553131104,
                    2.924999952316284,
                    2.947000026702881,
                    2.9519999027252197,
                    2.9590001106262207,
                    2.9809999465942383,
                    2.98799991607666,
                    2.997999906539917,
                    3.0209996700286865,
                    3.0269999504089355,
                    3.0380003452301025,
                    3.0490002632141113,
                    3.071000099182129,
                    3.111999988555908,
                    3.2850000858306885,
                    -1,
                    -1,
                    -1,
                    -1,
                    3.8910000324249268,
                    3.871999979019165,
                    3.8480000495910645,
                    3.818000316619873,
                    3.7980000972747803,
                    3.7809998989105225,
                    3.746000051498413,
                    3.7320001125335693,
                    3.7160003185272217,
                    3.6679999828338623,
                    3.6570000648498535,
                    3.640000104904175,
                    3.61299991607666,
                    3.5980002880096436,
                    3.5989999771118164,
                    3.5910000801086426,
                    3.622999668121338,
                    3.625999927520752,
                    3.631999969482422,
                    3.6760001182556152,
                    3.7049996852874756,
                    3.7229998111724854,
                    3.749000072479248,
                    3.7750000953674316,
                    3.7909998893737793,
                    3.8289999961853027,
                    3.8420000076293945,
                    3.877000093460083,
                    3.8949999809265137,
                    3.931999921798706,
                    3.950000047683716,
                    3.9860000610351562,
                    4.005000114440918,
                    4.019000053405762,
                    4.077000141143799,
                    4.090000152587891,
                    4.13100004196167,
                    4.368999481201172,
                    4.385000228881836,
                    4.37999963760376,
                    4.420000076293945,
                    4.432000160217285,
                    4.432000637054443,
                    -1,
                    -1,
                    -1,
                    -1,
                    7.335000038146973,
                    7.383999824523926,
                    7.434999465942383,
                    7.513999938964844,
                    7.564000129699707,
                    7.60099983215332,
                    7.7220001220703125,
                    7.76200008392334,
                    7.818999767303467,
                    7.934999942779541,
                    8.015999794006348,
                    8.149999618530273,
                    -1,
                    -1,
                    -1,
                    -1,
                    9.092000007629395,
                    9.105999946594238,
                    -1,
                    7.539000034332275,
                    7.517000198364258,
                    7.500999450683594,
                    7.473999977111816,
                    7.453999996185303,
                    7.431000232696533,
                    7.419999599456787,
                    7.38700008392334,
                    7.36899995803833,
                    7.3470001220703125,
                    7.324999809265137,
                    7.2930006980896,
                    7.300000190734863,
                    7.254000186920166,
                    7.261000156402588,
                    7.244999885559082,
                    7.2230000495910645,
                    7.388999938964844,
                    7.464000225067139,
                    7.547999858856201,
                    -1,
                    -1,
                    -1,
                    -1,
                    -1,
                    -1,
                    -1,
                    -1,
                    -1,
                    -1,
                    -1,
                    -1,
                    -1,
                    -1,
                    -1,
                    -1,
                    -1,
                    -1,
                    -1,
                    -1,
                    -1,
                    -1,
                    -1,
                    -1,
                    -1,
                    -1,
                    8.60099983215332,
                    8.336999893188477,
                    -1,
                    8.208999633789062,
                    8.220001220703125,
                    8.215999603271484,
                    8.20300006866455,
                    8.196000099182129,
                    8.213000297546387,
                    8.217000007629395,
                    8.310999870300293,
                    8.543000221252441,
                    8.553000450134277,
                    8.548999786376953,
                    8.5649995803833,
                    8.625,
                    8.720000267028809,
                    -1,
                    -1,
                    -1,
                    -1,
                    -1,
                    -1,
                    -1,
                    -1,
                    -1,
                    -1,
                    -1,
                    -1,
                    -1,
                    -1,
                    -1,
                    -1,
                    -1,
                    -1,
                    -1,
                    -1,
                    17.31599998474121,
                    17.304000854492188,
                    17.30900001525879,
                    17.29599952697754,
                    17.30900001525879,
                    -1,
                    -1,
                    -1,
                    -1,
                    14.237000465393066,
                    -1,
                    11.9350004196167,
                    11.852999687194824,
                    11.863999366760254,
                    11.862000465393066,
                    11.866000175476074,
                    11.885000228881836,
                    11.880999565124512,
                    11.881999969482422,
                    -1,
                    -1,
                    -1,
                    -1,
                    3.2300000190734863,
                    3.1519999504089355,
                    3.0369997024536133,
                    2.9739999771118164,
                    2.8450000286102295,
                    2.8559999465942383,
                    2.8519999980926514,
                    2.8590002059936523,
                    2.855999708175659,
                    2.8590002059936523,
                    2.8570001125335693,
                    2.8589999675750732,
                    2.859999895095825,
                    2.8589999675750732,
                    2.867000102996826,
                    2.878999948501587,
                    2.871999979019165,
                    -1,
                    2.890000104904175,
                    2.8889999389648438,
                    2.9010000228881836,
                    2.9040002822875977,
                    2.9040000438690186,
                    2.9070003032684326,
                    2.9059998989105225,
                    2.9099998474121094,
                    2.924999952316284,
                    2.930999994277954,
                    2.9240000247955322,
                    2.938999891281128,
                    2.947999954223633,
                    2.947999954223633,
                    2.9619996547698975,
                    2.9519999027252197,
                    2.9709999561309814,
                    2.9820001125335693,
                    2.9749999046325684,
                    2.9809999465942383,
                    2.98799991607666,
                    2.999000310897827,
                    2.999999761581421,
                    3.00600004196167,
                    3.015000104904175,
                    3.055000066757202,
                    3.0370001792907715,
                    -1,
                    -1,
                    -1,
                    2.871000051498413,
                    -1,
                    -1,
                    -1,
                    -1,
                    2.6600000858306885,
                    -1,
                    -1,
                    -1,
                    -1,
                    -1,
                    2.7149999141693115,
                    -1,
                    3.0448358058929443,
                    -1,
                    -1,
                    -1,
                    -1,
                    -1,
                    -1,
                    2.2170000076293945,
                    2.2060000896453857,
                    2.2119998931884766,
                    2.2209999561309814,
                    -1,
                    -1,
                    -1,
                    -1,
                    -1,
                    2.88700008392334,
                    2.8239996433258057,
                    2.876000165939331,
                    3.0929999351501465,
                    3.122999668121338,
                    3.138000011444092,
                    3.1549999713897705,
                    3.1730000972747803,
                    3.178999900817871,
                    3.187000274658203,
                    3.2100000381469727,
                    3.2179999351501465,
                    3.2260000705718994,
                    3.246999979019165,
                    3.2660000324249268,
                    3.2790000438690186,
                    3.3010003566741943,
                    3.311000108718872,
                    3.3480002880096436,
                    3.375999927520752,
                    3.3519999980926514,
                    3.3010003566741943,
                    3.2699999809265137,
                    3.243000030517578,
                    3.13100004196167,
                    3.121000051498413,
                    3.168999671936035,
                    3.1459999084472656,
                    3.128000020980835,
                    3.1070001125335693,
                    3.1050000190734863,
                    -1,
                    -1,
                    -1,
                    -1,
                    -1,
                    -1,
                    -1,
                    1.7453120946884155,
                    1.7560001611709595,
                    1.7410001754760742,
                    1.7280000448226929,
                    1.6965821981430054,
                    1.7050000429153442,
                    1.6979999542236328,
                    1.6702167987823486,
                    1.6779999732971191,
                    1.6690000295639038,
                    1.6433171033859253,
                    1.6519999504089355,
                    1.652999997138977,
                    1.6190643310546875,
                    1.6269999742507935,
                    1.6059871912002563,
                    1.6160001754760742,
                    1.6080000400543213,
                    1.57904052734375,
                    1.590999960899353,
                    1.5762183666229248,
                    1.5859999656677246,
                    1.562647819519043,
                    1.5629093647003174,
                    1.5555273294448853,
                    1.5603541135787964,
                    1.5549999475479126,
                    1.5585417747497559,
                    1.565000057220459,
                    1.5570000410079956,
                    1.5570000410079956,
                    1.5579999685287476,
                    1.5509999990463257,
                    1.555999994277954,
                    1.5490001440048218,
                    1.5470000505447388,
                    1.5490000247955322,
                    1.5509999990463257,
                    1.5490000247955322,
                    1.5509999990463257,
                    1.5529998540878296,
                    1.5470000505447388,
                    1.5460000038146973,
                    1.4609512090682983,
                    1.50600004196167,
                    1.5019999742507935,
                    1.4869998693466187,
                    1.472000002861023,
                    1.4550000429153442,
                    1.444000005722046,
                    1.413187026977539,
                    1.4140000343322754,
                    1.4003368616104126,
                    1.3990000486373901,
                    1.3944345712661743,
                    1.3969999551773071,
                    1.3890000581741333,
                    1.4079999923706055,
                    1.4210000038146973,
                    1.437999963760376,
                    1.4670000076293945,
                    1.4800000190734863,
                    1.4900000095367432,
                    1.5169999599456787,
                    1.537000060081482,
                    1.5470000505447388,
                    1.5889999866485596,
                    1.6059998273849487,
                    1.628000020980835,
                    1.6610000133514404,
                    1.6779999732971191,
                    1.6929999589920044,
                    1.7410000562667847,
                    1.7599998712539673,
                    1.7860000133514404,
                    1.8240000009536743,
                    1.8550000190734863,
                    1.88100004196167,
                    1.9210000038146973,
                    1.9520000219345093,
                    1.9789999723434448,
                    2.0239999294281006,
                    2.0360000133514404,
                    2.0309998989105225,
                    2.0299999713897705,
                    2.0299999713897705,
                    2.0230000019073486,
                    2.015000104904175,
                    2.0209999084472656,
                    2.0250000953674316,
                    2.063999891281128,
                    2.1449999809265137,
                    2.1389999389648438,
                    2.124000072479248,
                    -1,
                    -1,
                    -1,
                    -1,
                    -1,
                    -1,
                    -1,
                    -1,
                    -1,
                    1.3255410194396973,
                    -1,
                    -1,
                    -1,
                    1.3061513900756836,
                    1.303368330001831,
                    1.3048079013824463,
                    1.3013930320739746,
                    1.3015888929367065,
                    -1,
                    -1,
                    1.2941185235977173,
                    1.296787142753601,
                    1.2927055358886719,
                    1.2946730852127075,
                    1.2935361862182617,
                    1.2966150045394897,
                    1.295422077178955,
                    1.289433240890503,
                    1.290000557899475,
                    1.2911033630371094,
                    1.2880364656448364,
                    1.2873477935791016,
                    1.2935936450958252,
                    -1,
                    1.2805614471435547,
                    1.286842703819275,
                    1.2872200012207031,
                    1.282771110534668,
                    1.2891820669174194,
                    1.2792354822158813,
                    1.2828270196914673,
                    1.2848167419433594,
                    1.2840458154678345,
                    1.2874789237976074,
                    1.2839807271957397,
                    1.2862250804901123,
                    1.2920777797698975,
                    1.279586911201477,
                    1.2828514575958252,
                    1.2885117530822754,
                    1.2878398895263672,
                    1.2908791303634644,
                    1.2913517951965332,
                    1.2972513437271118,
                    1.303688406944275,
                    1.3152216672897339,
                    1.319694995880127,
                    1.330225944519043,
                    1.33484947681427,
                    1.3384058475494385,
                    1.3437000513076782,
                    1.3463451862335205,
                    1.3489075899124146,
                    1.364946722984314,
                    1.3635051250457764,
                    1.3747224807739258,
                    1.382023811340332,
                    1.3879978656768799,
                    1.3882683515548706,
                    1.3946455717086792,
                    1.3889405727386475,
                    1.382431983947754,
                    1.3843035697937012,
                    1.3766716718673706,
                    1.372115969657898,
                    1.3723465204238892,
                    1.3679893016815186,
                    1.3632081747055054,
                    1.3556009531021118,
                    1.358919382095337,
                    1.3538854122161865,
                    1.3552522659301758,
                    1.3491910696029663,
                    1.3481764793395996,
                    1.3434289693832397,
                    1.3440678119659424,
                    1.3445756435394287,
                    1.3371613025665283,
                    1.3365503549575806,
                    1.3367018699645996,
                    1.341056227684021,
                    1.3426775932312012,
                    1.3399919271469116,
                    1.539917230606079,
                    1.5476984977722168,
                    -1,
                    -1,
                    -1,
                    -1,
                    -1,
                    -1,
                    -1,
                    -1,
                    -1,
                    -1,
                    -1,
                    -1,
                    -1,
                    -1,
                    -1,
                    1.386171817779541,
                    1.366230845451355,
                    -1,
                    -1,
                    -1,
                    -1,
                    -1,
                    -1,
                    -1,
                    -1,
                    1.4080688953399658,
                    -1,
                    -1,
                    1.8244165182113647,
                    -1,
                    -1,
                    2.376126527786255,
                    -1,
                    -1,
                    -1,
                    -1,
                    2.1476473808288574,
                    2.147404193878174,
                    2.1818337440490723,
                    2.1756696701049805,
                    2.134115695953369,
                    2.0742545127868652,
                    -1,
                    -1,
                    -1,
                    -1,
                    -1,
                    -1,
                    -1,
                    -1,
                    -1,
                    -1,
                    -1,
                    1.6884087324142456,
                    1.7133320569992065,
                    1.7243059873580933,
                    1.752785563468933,
                    1.7787235975265503,
                    1.7360950708389282,
                    1.6991773843765259,
                    1.684401273727417,
                    1.7121472358703613,
                    1.677269697189331,
                    -1,
                    1.6659705638885498,
                    1.6346848011016846,
                    1.6468642950057983,
                    1.663728952407837,
                    -1,
                    -1,
                    -1,
                    -1,
                    -1,
                    -1
                ],
                "rangeMax": 25,
                "rangeMin": 0.10000000149011612,
                "timestamp": 1646222766639612700
            }
        }
    ]

    const calRotation = (name: string, item: any) => {
        const xAxis = new THREE.Vector3(1, 0, 0)
        const yAxis = new THREE.Vector3(0, 1, 0);
        switch (name) {
            case 'elfin_joint1':
                //    item.rotation.y = jointStates[name];
                return { axis: 'y', rotation: jointStates[name] }

            case 'elfin_joint2':
                //  item.rotation.x = jointStates[name] * -1
                return { axis: 'x', rotation: jointStates[name] * -1 }

            case 'elfin_joint3':
                //  item.rotation.x = jointStates[name] + Math.PI
                return { axis: 'x', rotation: jointStates[name] + Math.PI }

                break
            case 'elfin_joint4':
                // item.rotation.y = jointStates[name]
                return { axis: "y", rotation: jointStates[name] }

                break;
            case 'elfin_joint5':
                //  item.rotation.x = jointStates[name]
                return { axis: 'x', rotation: jointStates[name] }

                break;
            case 'elfin_joint6':
                // item.rotation.y = -jointStates[name]
                return { axis: 'y', rotation: jointStates[name] * -1 }
                break;
            default:

        }
    }

    let model: any;
    function initLight() {
        const dirLight1 = new THREE.DirectionalLight(0xffffff);
        dirLight1.position.set(1, 1, 1);
        scene.add(dirLight1);

        const dirLight2 = new THREE.DirectionalLight(0x002288);
        dirLight2.position.set(-1, -1, -1);
        scene.add(dirLight2);

        const ambientLight = new THREE.AmbientLight(0x404040);
        scene.add(ambientLight);
    }
    function loadDeviceModel() {
        const dracoLoader = new DRACOLoader();
        dracoLoader.setDecoderPath('robot/draco/')
        dracoLoader.setDecoderConfig({ type: 'js' });
        dracoLoader.preload();
        const gltfloader = new GLTFLoader();
        gltfloader.setDRACOLoader(dracoLoader);
        const url = 'model/QD6003.gltf';
        gltfloader.load(url, (gltf) => {
            gltf.scene.renderOrder = 8;
            gltf.scene.position.set(0, 0, 0);
            //    console.log(gltf.scene, gltf.animations)
            const bbox = new THREE.Box3().setFromObject(gltf.scene);
            gltf.scene.traverse((mesh: any) => {
                if (mesh.name === 'left_arm_joint1') {
                    mesh.rotation.y = -1.5549363323617325
                }
                if (mesh.name === 'left_arm_joint2') {
                    mesh.rotation.x = 0.36723984177206154
                }
                if (mesh.name === 'left_arm_joint3') {
                    mesh.rotation.x = 1.9213370410790347
                }
                if (mesh.name === 'left_arm_joint4') {
                    mesh.rotation.y = -9.539917647432361e-05
                }
                if (mesh.name === 'left_arm_joint5') {
                    mesh.rotation.x = -0.00015472702254044524
                }
                if (mesh.name === 'left_arm_joint6') {
                    mesh.rotation.z = 0.00020408779046745846
                }
                if (mesh.material) {
                    mesh.material.format = THREE.RGBAFormat



                }
            });
            console.log(gltf.scene)
            scene.add(gltf.scene)
            setTimeout(() => {
                animation(gltf.scene, )
                // gltf.scene.traverse((item: any) => {
                //     Object.keys(jointStates).forEach((name: string, index: any) => {
                //         if (name === item.name) {
                //             const { axis, rotation } = calRotation(name, item)
                //             animation(item, [0, rotation], axis)
                //         }
                //     })
                // })
            }, 0)

        })
    }
    function animate() {
        let raf = requestAnimationFrame(animate)
        const delta = clock.getDelta();

        mixers.forEach((mixer) => {
            mixer.update(delta)
        })
    }
    function loadPoints() {
        const vertices: any[] = []
        const color: any[] = []
        const { angleMin, angleIncrement, data } = lidarData[0].value;
        const point1 = [data[0], 0, 0]
        const point2 = []
        data.forEach((item: any, index: any) => {
            if (item !== -1) {
                const distance = item / 0.05
                const x = distance * Math.cos(index * angleIncrement + angleMin)
                const z = distance * Math.sin(index * angleIncrement + angleMin)
                vertices.push(x + 100, 0, -z + 200)

            }
        })
        const geometry = new THREE.BufferGeometry();
        geometry.setAttribute('position', new THREE.Float32BufferAttribute(vertices, 3));

        const material = new THREE.PointsMaterial({ color: 0xdef5d7, size: 2, });

        const points = new THREE.Points(geometry, material);
        scene.add(points);
    }
    function loadExampleModel() {
        const dracoLoader = new DRACOLoader();
        dracoLoader.setDecoderPath('robot/draco/')
        dracoLoader.setDecoderConfig({ type: 'js' });
        dracoLoader.preload();
        const gltfloader = new GLTFLoader();
        //      gltfloader.setDRACOLoader(dracoLoader);
        const url = 'model/Xbot.glb';
        gltfloader.load(url, (gltf) => {
            gltf.scene.position.set(0, 0, 0);
            //        console.log(gltf.scene, gltf.animations)
            const skeleton = new THREE.SkeletonHelper(gltf.scene);
            skeleton.visible = false;
            //      console.log(skeleton)
            scene.add(skeleton);
            // gltf.scene.scale.set(20, 20, 20)
            const bbox = new THREE.Box3().setFromObject(gltf.scene);
            scene.add(gltf.scene)
            // gltf.scene.traverse((item: any) => {
            //     if (item.animations.length > 0) {
            //         console.log(item)
            //     }
            // })

        })

    }
    function animation(object: any,) {
      
        const rotation = object.rotation.clone()
        const qInitial = object.quaternion;
        const qFinal = new THREE.Quaternion().setFromEuler(rotation)
        const positionKF = new THREE.VectorKeyframeTrack('.position', [0,3], [0,0,0,10,10,10]);

        const quaternionKF = new THREE.QuaternionKeyframeTrack(
            '.quaternion',
            [0, 3],
            [
                qInitial.x,
                qInitial.y,
                qInitial.z,
                qInitial.w,
                qFinal.x,
                qFinal.y,
                qFinal.z,
                qFinal.w,
                // qInitial.x,
                // qInitial.y,
                // qInitial.z,
                // qInitial.w,
            ],
        );
        const clip = new THREE.AnimationClip('Action', 3, [
            // positionKF
        ]);
        const mixer = new THREE.AnimationMixer(object);
        const clipAction = mixer.clipAction(clip);
        clipAction.loop = THREE.LoopOnce;
        clipAction.clampWhenFinished = true;
        mixers.push(mixer)
        clipAction.play();
        mixer.addEventListener('finished',()=>{
            console.log('finish')
        })
    }
    console.log('abcd')
    setTimeout(() => {
        animate()

    }, 10)
    loadPoints()
    initLight();
    loadDeviceModel()
    // animate()
    //    loadExampleModel()
    scene.add(new THREE.AxesHelper(200));
    return scene;
}